"use strict";angular.module("Taotaobao",[]).controller("Ctrl",["$scope","$http",function(e,r){e.currencyType="人民幣",e.currencyRate=5.15,e.unitPrice=47,e.shipping=16,e.purchases=[],e.getCurrencyRate=function(){var n="http://rate-exchange.appspot.com/currency?callback=JSON_CALLBACK&from=CNY&to=TWD&q=1";r({method:"JSONP",url:n}).success(function(r){e.currencyStatus="更新完成！",e.currencyRate=r.rate,e.showCurrencyTip=!0}).error(function(){e.currencyStatus="更新失敗",e.showCurrencyTip=!1})},e.changeCurrencyType=function(){e.disabledSetCurrencyRate?(e.currencyType="新台幣",e.currencyRate=1,e.unitPrice=800,e.shipping=80,e.shippingMethod=e.shippingMethods[2]):(e.currencyType="人民幣",e.currencyRate=4.8,e.unitPrice=47,e.shipping=16,e.shippingMethod=e.shippingMethods[0])},e.shippingMethods=[{name:"每公斤",value:0,hide:0,disabledSetUnitWeight:0},{name:"每件",value:1,hide:0,disabledSetUnitWeight:1},{name:"總運費（忽略重量或件數）",value:2,hide:0,disabledSetUnitWeight:1},{name:"不考慮運費",value:3,hide:1,disabledSetUnitWeight:1}],e.shippingMethod=e.shippingMethods[0],e.price=function(){return e.number*e.unitPrice*e.currencyRate},e.portage=function(){switch(e.shippingMethod.value){case 0:var r=e.shipping*e.currencyRate*e.number*e.unitWeight/1e3;break;case 1:var r=e.shipping*e.currencyRate*e.number;break;case 2:var r=e.shipping*e.currencyRate;break;case 3:var r=0}return r},e.addPurchase=function(){e.purchases.push({removed:!1,name:e.name,unitPrice:e.unitPrice*e.currencyRate,number:e.number,unitWeight:e.unitWeight/1e3,shipping:e.shipping*e.currencyRate,shippingMethod:e.shippingMethod,currencyRate:e.currencyRate,price:e.price(),portage:e.portage()})},e.archive=function(){var r=e.purchases;e.purchases=[],angular.forEach(r,function(r){r.removed||e.purchases.push(r)})},e.remaining=function(){var r=0;return angular.forEach(e.purchases,function(e){r+=e.removed?0:1}),r},e.portageSum=function(){var r=0;return angular.forEach(e.purchases,function(e){e.removed||(r+=e.portage)}),r},e.priceSum=function(){var r=0;return angular.forEach(e.purchases,function(e){e.removed||(r+=e.price)}),r},e.numberSum=function(){var r=0;return angular.forEach(e.purchases,function(e){e.removed||(r+=e.number)}),r}}]);